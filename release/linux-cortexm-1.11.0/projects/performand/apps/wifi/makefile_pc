#
# Makefile for eMPL Linux userland implementation __x86__
# 

CC = gcc
CFLAGS := -pthread -DVERBOSITY=1
LDFLAGS	:= -lrt

DIR_GUARD = @mkdir -p $(@D)

BUILDDIR := build
BINARIES := data_parser
SOURCETREE = $(wildcard $1$2) $(foreach d,$(wildcard $1*),$(call SOURCETREE,$d/,*.c))
EXT_SOURCES = $(call SOURCETREE,../Common/,*.c)
GAINSPAN_SOURCES = $(call SOURCETREE,gainspan/,*.c)

SOURCES := $(wildcard *.c) $(EXT_SOURCES) $(GAINSPAN_SOURCES)
OBJECTS := $(addprefix $(BUILDDIR)/, $(notdir $(SOURCES:%.c=%.o)))
VPATH := $(subst  ,:,$(dir $(SOURCES)))

all : $(BINARIES)

redo : clean $(BINARIES)
	
$(BINARIES): %: $(OBJECTS)
	@echo "Compiling " $@
	$(CC) $(CFLAGS) $(OBJECTS) -lm -o $@ $(LDFLAGS)

$(BUILDDIR)/%.o: %.c
	$(CC) $(CFLAGS) -I$(dir $<) -c $< -o $@

clean:
	rm -rf $(OBJECTS) $(BINARY) $(BINARY).gdb
